<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Day One JSON 工具</title>
  <style>
    body { margin:0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans TC", sans-serif; background:#f8f9fa; }
    header { background:#2c3e50; color:#fff; padding: 12px 16px; display:flex; align-items:center; justify-content:space-between; }
    header .left { display:flex; align-items:center; gap:12px; }
    header .right { display:flex; align-items:center; gap:12px; }
    header button { border:none; background:#34495e; color:#fff; padding:6px 10px; border-radius:6px; cursor:pointer; }
    header button:hover { background:#3e5a72; }
    #main { display: grid; grid-template-columns: 360px 1fr; height: calc(100vh - 48px); }
    #sidebar { border-right:1px solid #ccc; background:#fff; overflow:auto; padding: 8px; }
    .item { display:flex; align-items:flex-start; gap:8px; padding:8px; border-bottom:1px dashed #ddd; cursor:pointer; }
    .item:hover { background:#f0f0f0; }
    .item .meta { flex:1; }
    .title { font-weight:bold; }
    .dim { font-size:12px; color:#666; }
    #preview { padding:16px; overflow:auto; background:#fff; }
    #preview .filename { font-size:14px; color:#444; margin-bottom:8px; }
    #preview .mode-btn { float:right; margin-left:8px; }
    pre { background:#f4f4f4; padding:12px; border-radius:6px; white-space:pre-wrap; word-wrap:break-word; }
    .toolbar { padding:8px; display:flex; gap:8px; border-bottom:1px solid #ddd; background:#fafafa; }
    .btn { padding:6px 10px; border:1px solid #ccc; background:#fff; border-radius:6px; cursor:pointer; }
    .btn:hover { background:#eee; }
  </style>
</head>
<body>

<header>
  <div class="left">
    <button onclick="location.href='index.html'">← 返回首頁</button>
    <strong>Day One JSON 工具</strong>
  </div>
  <div class="right">
    <button onclick="toggleMode()" class="btn">切換模式</button>
  </div>
</header>

<div id="main">
  <div id="sidebar">
    <div class="toolbar">
      <input type="file" id="fileInput" accept=".json">
    </div>
    <div id="list"></div>
  </div>
  <div id="preview">
    <div class="filename">尚未選取條目</div>
    <div id="content"><div style="color:#888;">請從左側選擇一條目預覽</div></div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
let entries = [], rawMd = [], currentIndex = -1, showRaw = false;

document.getElementById('fileInput').addEventListener('change', async (e)=>{
  const file = e.target.files[0];
  const json = JSON.parse(await file.text());
  entries = json.entries || [];
  renderList();
});

function renderList(){
  const $list = document.getElementById('list');
  $list.innerHTML = '';
  entries.forEach((e, i) => {
    const div = document.createElement('div');
    div.className = 'item';
    div.innerHTML = `
      <input type="checkbox" data-i="${i}">
      <div class="meta">
        <div class="title">${(e.text || '').split('\n')[0] || '無標題'}</div>
        <div class="dim">${e.creationDate || ''}</div>
      </div>
    `;
    div.onclick = () => preview(i);
    $list.appendChild(div);
  });
}

function preview(i){
  currentIndex = i;
  const e = entries[i];
  const md = e.text || '(空白)';
  const html = marked.parse(md);
  rawMd[i] = md;
  document.querySelector('.filename').textContent = e.creationDate || '無日期';
  document.getElementById('content').innerHTML = showRaw ? `<pre>${md}</pre>` : html;
}

function toggleMode(){
  showRaw = !showRaw;
  if(currentIndex >= 0) preview(currentIndex);
}
</script>

</body>
</html>
